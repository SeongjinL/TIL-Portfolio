# 개념정리
- HOST (주인)
  - 메인프레임(HOST machine)
- Client 
- DBMS

스프레드시트 = Excel


### 현재 사용되는 DATABASE SYSTEM
- ORACLE DataBase
- MS SQL Server
- NOSQL
- Infor mix
- DB/2

### 인터페이스
- GUI(graphical user interface)
- CLI(command Line Interface)

#### 데이터
- 현실 세계로 부터 관찰이나 측정 드으이 수단을 통하여 수집한 사실이나 값

#### SQL 이란?
- 데이터베이스를 구축하고 활용하기 위해 사용하는 언어
- DB를 조작하는 언어로 초기 IBM에서 사용화 함
- 미국 국립 표준 협회가 이를 표준으로 재정 함
- 보안이 중요하다
- PRIMARY Key(데이터에서 제일 대표적인)
- Foreign Key(릴레이션십)
- RDBMS
- ID는 중복되지 않는다.

# DATABASE (SQL 기본퀴리 구조)
- SELECT 필드명1, ..., 필드명 n
- FROM 테이블명
- WHERE 조건
- GROUP BY 필드명
- HAVING 조건
- ORDER BY 필드면 (ASC | DESC)



#### DB OBJECT
- Index
  - 인덱스란 추가적인 쓰기 작업과 저장 공간을 활용하여 데이터베이스 테이블의 검색 속도를 향상시키기 위한 자료구조이다. 만약 우리가 책에서 원하는 내용을 찾는다고 하면, 책의 모든 페이지를 찾아 보는것은 오랜 시간이 걸린다. 그렇기 때문에 책의 저자들은 책의 맨 앞 또는 맨 뒤에 색인을 추가하는데, 데이터베이스의 index는 책의 색인과 같다. 데이터베이스에서도 테이블의 모든 데이터를 검색하면 시간이 오래 걸리기 때문에 데이터와 데이터의 위치를 포함한 자료구조를 생성하여 빠르게 조회할 수 있도록 돕고 있다.
- 종속관계
- Table
  - 하나 또는 여러 `컬럼(Column)`들이 모여 하나의 레코드를 이룹니다. 이러한 레코드들이 모여 테이블이 됩니다. 예를 들어 `사원` 테이블은 사번, 이름, 부서 등 여러 컬럼을 갖게 되며 사원수 만큼의 레코드를 갖게 됩니다. 테이블은 시스템테이블과 사용자 테이블로 구분 할 수 있습니다. 시스템테이블의 경우는 대부분 SQL Server가 내부적으로 관리를 목적으로 사용되어집니다. 물론 이들 시스템테이블을 참조하면 여러가지 정보를 얻을 수 있지만 시스템테이블을 직접 참조하는 것은 권장되지 않는 방법입니다. 대신 시스템 저장프로시져나 스키마뷰를 이용해서 이러한 정보를 참조할 수 있습니다. 이제 대해서는 나중에 자세히 살펴보도록 하겠습니다.
- View
  - 뷰는 실제로는 존재하지 않는 가상의 논리적인 테이블입니다. 실제 테이블을 기준으로 사용자 입장에서 논리적인 테이블을 만들어 쉽게 접근 할 수 있게 합니다. 뷰는 사용의 편리성과 보안성을 제공해 줍니다.

- Stored Procedure
  - 복잡한(단순해도 상관없습니다) 쿼리문을 저장해 두었다가 손쉽게 재사용 할 수 있는 저장 프로시져 입니다. 저장 프로시져가 만들어질때(CREATE PROCEDURE) 소스가 미리 컴파일되어 있고 수행 계획이 처음 수행될 때만 한번 만들어지고 이후에는 이러한 과정이 생략되므로 일반적인 쿼리수행에 비해 빠른 성능을 제공합니다.

- Trigger
  - 테이블의 값이 변경(INSERT, UPDATE, DELETE)될 때 자동적으로 수행되는 저장 프로시져의 하나입니다.

- Data Type
  - SQL Server가 제공하는 기본적인 데이터 형식말고도 사용자가 임으로 정할 수 있는 데이터 형식을 가리킵니다. 예를 들어 사원번호를 선언하는데 있어 어느 개발자는 CHAR(05)로, 어느 개발자는 CHAR(10) 또는 VARCHAR(10)과 같이 서로 다르게 사용할 수 있는데, 이를 해결하기 위하여 SABUN_TYPE 이라는 데이터 형식을 만들어 CHAR(05)로 선언하면 개발자들은 사원번호의 데이터 형식을 SABUN_TYPE 이라고 지정해서 사용하면 됩니다.

- Default
  - 데이터가 입력될 때 값이 들어오지 않으면 자동으로 입력되도록 Default 를 지정할 수 있습니다. 만일 주소 칼럼에 데이터를 저장하는데 (unknown) 을 Deault로 하면주소가 입력되지 않으면 (unknown)이 자동으로 입력됩니다.

- Rule
  - 특정 칼럼에 대하여 저장될 수 있는 값을 지정할 때 사용됩니다.

- Constraint
  - 데이터의 무결성을 위해서 제약을 주는 것입니다. Primary Key, Foreign Key, Check 등이 있습니다.

- User Defiend Function
  - 사용자 정의 함수는 SQL Server 2000에서 새롭게 선보이는 기능입니다. 특정한 값은 물론 테이블까지 사용자 정의 함수의 결과값이 될 수 있어 매우 유용하게 사용됩니다.

3. 데이터베이스 객체 사용하기
데이터베이스 객체를 지정하기 위해서는 다음의 형식을 따라야 합니다.
서버명.데이터베이스명.소유자.객체명
예를 들어 NTSRV01.Northwind.dbo.Orders 와 같이 사용합니다. 객체명을 제외한 앞 세부분은 생락이 가능한데 이 경우 다음과 같은 의미를 갖게 됩니다.
- 서버명을 생략하면 현재 로그인한 SQL Server명이 기본값으로 사용됩니다.
- 데이터베이스명을 생략하면 현재 사용중인 데이터베이스를 기본값으로 사용됩니다.
- 소유자가 생락되면 현재 연결한 사용자 계정이 기본값으로 사용됩니다.
이런 이유로 실제 개발시 많은 부분이 생략되어 사용됩니다. 하지만 나중에 스크립트를 볼 때 쉽게 파악이 가능하도록 되도록이면 붙여주는데 좋다고 생각합니다. 가끔은 자기가 작성한 스크립트를 자신도 이해하지 못하는 경우가 발생합니다.
외국 회사로부터 컨설팅을 받는 가운데 그들이 작성한 소스를 보면 경악을 금치 못합니다. 소스 구석 구석의 너무 과하다고 생각될 정도의 커멘트 때문입니다. 본받을 만한 습관이라고 생각합니다

### 데이터베이스 구조
1. 데이터베이스란?
   1. 데이터베이스란 무엇이가를 저장해 두는 곳이라고 우선 정의할수 있습니다. 이때 무엇인가에 포함되는 것은 테이블(Table), 뷰(View), 인덱스(Index), 저장 프로시져(Stored Procedure), 트리거(Trigger)와 같은 객체(Object)들 입니다.데이터베이스의 객체에 대해서는 예전에 간략하게 설명한적이 있습니다. 머지 않아 각각의 객체들에 대해서 엄청 많이 이야기하게 될것 같습니다.

2. 데이터베이스를 구성하는 파일
   1. SQL Server의 데이터베이스는 운영체제 상에서 보면 확장자가 mdf(또는 ndf)와 ldf 인 파일로 존재하게 됩니다. 예를 들어 연습용 데이터베이스인 pubs 데이터베이스의 경우는 pubs.mdf와 pubs_log.ldf 두개의 파일이 존재합니다.

데이터베이스는 데이터와 로그로 분리되어 저장됩니다. 데이터의 경우는 mdf 확장자(또는 ndf)를 갖으며, 로그의 경우는 ldf 확장자를 갖고 저장됩니다. 확장자(mdf, ndf, ldf)는 반드시 정해진 것이 아니며 원하는 경우 바꿀 수가 있지만 되도록 그대로 사용하는것이 바람직합니다. 확장자를 봄으로써 어떤 역할을 하는 파일인지 구분을 할 수 있기 때문입니다. 만일 pubs.mdf를 pubs.doc 으로 한다면 워드파일이지 데이터 파일이라고 생각 할 수 없기 때문입니다.(만든 사람만 알 수 있겠지요)

다음의 그림은 데이터베이스의 구조를 간단히 보여주고 있습니다.

1. 데이터 파일(*.mdf, *.ndf)
   1. 실제 자료를 저장합니다. 기본적으로 데이터 파일은 하나만 있어도 되지만 필요하면 더 만들 수 있습니다. 처음 만들어진 파일이 mdf 확장자를 갖게 되며 추가되는 파일은 확장자가 ndf 가 됩니다.

2. 로그 파일(*.ldf)
   1. 로그는 트랜잭션 처리와 시스템에 문제가 발생했을 때 복구를 위해 사용됩니다. 보통 데이터 파일의 25% 정도의 사이즈를 갖습니다.

3. Page와 Extents
   1. 저는 계산하는 것을 참 싫어 합니다. 하지만 여기서는 약간의 계산을 해보고자 합니다.

4. Page
   1. 데이터는 8KB 단위의 블럭을 단위로 저장되는데 이를 페이지(Page)라고 합니다. 결과적으로 데이터베이스는 1MB에는 128Page를 저장 할 수 있게됩니다. 하나의 Row는 여러개의 Page에 걸쳐 저장 될 수 없고 단 하나의 Page에만 저장 될 수 있습니다. 이 사실을 통해 하나의 Row(데이터 레코드로 생각하셔도 됩니다.)의 최대 사이즈는 8060 바이트입니다. 계산해보면 8 X 1024 는 8192 입니다. 하지만 8192바이트를 Row가 전부 차지하지 못하는 이유는 몇가지 정보를 저장하기 위한 약간의 공간(8192 - 8060 = 132)이 필요하기 때문입니다. 간단히 설명한다면 페이지 헤더가 이 공간중에 96KB를 사용하게 되고 나머지는 각 Row가 저장되고 관리되기 위한 몇몇 정보를 기록하는데 사용됩니다.

5. Extent
   1. 테이블과 인덱스는 Extent에 저장됩니다. Extent란 8개의 연속된 페이지를 가리킵니다. 1 Page가 8KB 이므로 1 Extent는 64KB(8 KB X 8) 입니다.

#### 데이터의 분류
1. 데이터베이스의 분류

- 시스템 데이터베이스
  - Master, Model, Tempdb, Msdb, Distribution 데이터베이스를 시스템 데이터베이스라고 합니다. 이들 데이터베이스는 SQL Server가 설치되면 자동적으로 생성됩니다.(Distribution 데이터베이스는 예외) 시스템 데이터베이스는 SQL Server에 대한 정보를 가지고 있으며, SQL Server가 데이터베이스를 관리하기 위해서 사용됩니다. 그러므로 사용자는 시스템 데이터베이스를 함부로 수정해서는 안됩니다.
    - Distribution 데이터베이스는 SQL Server를 처음 인스톨 할 때는 만들어지지 않고 Replication 이 설정될 때 만들어져 배포자(Publisher)와 구독자(Subscriber) 사이에서 복제할 내용을 전달하는 역할을 수행합니다. 이들 시스템 데이터베이스 각각의 역할은 잠시후에 살펴보도록 하겠습니다.

- 예제 데이터베이스
  - Pubs, Northwind 데이터베이스가 예제 데이터베이스입니다. 이 두개의 데이터베이스는 사용자가 SQL Server를 공부할 때 사용 할 수 있는 샘플이 되는 데이터베이스입니다. 제가 강좌를 진행하면서도 이 두 데이터베이스를 많이 이용하게 될 것입니다.

- 사용자 데이터베이스
  - 이외에 사용자가 만든 데이터베이스를 사용자 데이터베이스라고 합니다. 어떻게 보면 가장 중요한 데이터베이스라고 할 수 있습니다. 이렇게 SQL Server를 공부 하는 것도 이 사용자 데이터베이스를 효율적으로 관리하고 사용하는 방법을 배우기 위한 것이라고 생각합니다.

1. 시스템 데이터베이스

다음은 EM(Enterprose Manager)에서 본 시스템 데이터베이스와 예제 데이터베이스 입니다.

- Master 데이터베이스
  - 여러가지의 데이터베이스가 SQL Server에 만들어질 수 있습니다. 그렇다면 이러한 데이터베이스를 대표하여 관리해 줄 별도의 데이터베이스가 필요합니다. 이것이 바로 Master 데이터베이스입니다. Master 데이터베이스는 SQL Server의 여러가지 환경 정보와 로그인 정보, 전체 데이터베이스에 대한 정보를 갖고 있습니다. 그러므로 가장 중요한 System 데이터베이스라고 할 수 있습니다.

- Model 데이터베이스
  - 데이터베이스의 이름에서 그 역할을 추측 할 수 있습니다. 사용자 데이터베이스를 만들때(CREATE DATABASE) 이 Model 데이터베이스가 복사가되어 만들어 집니다. 이런 이유로 Model 데이터베이스의 설정을 변경하면 이후에 만들어지믄 사용자 데이터베이스에 그 내용이 반영되어 일관성있는 사용자 데이터베이스 생성을 가능하게 합니다. 예를 들어 앞으로 만들어질 사용자 데이터베이스에 특정 계정을 만들고 싶을 때 이 계정을 Model 데이터베이스에 만들어 두면 별도의 작업이 없이도 새로 만들어지는 데이터베이스에 이 계정이 포함되게 됩니다.
- Tempdb 데이터베이스
  - SQL Server가 운영될 때 만들어지는 임시테이블들이 생성되는 곳입니다. Tempdb는 SQL Server가 재시작 될 때마다 초기화 되므로 사용자 테이블을 Tempdb에 만드는 것은 바람직하지 않습니다. 가끔 Tempdb에 테이블을 만들어 두고나서 나중에 자동으로 지워진 후 누가 지웠냐고 난리법석을 떠는 것을 본적이 있습니다. 우리는 이런 실수를 해서는 안되겠습니다. 물론 테스트를 위한 임시 테이블은 이곳에 만들어도 됩니다. 저도 테스트용 테이블을 만들어 확인 할 때 가끔 사용하게 됩니다.

- Msdb 데이터베이스
  - Job에 대한 정보를 갖습니다. Alert 및 Operator에 대한 정보를 관리하게 되며, DTS에 대한 정보도 Msdb에 기록됩니다. SQL Server 관련 서비스 중에서 MSSQLServer Agent 서비스가 대부분 사용하는 데이터베이스입니다.

1. 예제 데이터베이스

SQL Server가 설치되면 연습용 데이터베이스 두개가 만들어집니다.

- Pubs
- Northwind

이 두 데이터베이스는 SQL Server를 공부할 때 유용하게 사용될 수 있으며 실제로 여러 교재에서 예제로 사용됩니다. 만일 이 두 데이터베이스에 문제가 생기면 SQL Server 폴더의 Install 폴더에 있는 Instpubs.sql, Instnwnd.sql 스크립트를 수행하여 언제든지 재생성 할 수 있습니다.